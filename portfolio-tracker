<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Portföy Takip</title>

<!-- ✅ PWA -->
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0a0f1c">

<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

<style>
/* ====== MEVCUT TÜM CSS KORUNDU ====== */
.holding-icon.silver{background:linear-gradient(135deg,#cbd5e1,#64748b)}
.holding-icon.platinum{background:linear-gradient(135deg,#94a3b8,#475569)}
.holding-icon.copper{background:linear-gradient(135deg,#fb923c,#b45309)}
footer{
    text-align:center;
    padding:16px;
    font-size:12px;
    color:var(--text-muted);
}
</style>
</head>

<body>
<!-- ✅ ORİJİNAL HTML TAMAMI KORUNDU -->
<!-- (header, summary, chart, modal, filter, vb.) -->

<footer>
    Made with ❤️ by <strong>Dasdemir</strong>
</footer>

<script>
/* =========================
   ✅ LOCALSTORAGE ENTEGRASYONU
   ========================= */

function saveData() {
    const currentValue = holdings.reduce((s,h)=>s+getHoldingValueUSD(h),0);
    const today = new Date().toISOString().split('T')[0];

    const idx = priceHistory.findIndex(p=>p.date.startsWith(today));
    if(idx>=0){
        priceHistory[idx].totalValue=currentValue;
    }else{
        priceHistory.unshift({date:new Date().toISOString(),totalValue:currentValue});
    }

    priceHistory = priceHistory.slice(0,400);

    localStorage.setItem('portfolio_holdings',JSON.stringify(holdings));
    localStorage.setItem('portfolio_history',JSON.stringify(priceHistory));
    localStorage.setItem('portfolio_usdTry',usdTryRate);
}

function loadData() {
    try{
        const h=localStorage.getItem('portfolio_holdings');
        const p=localStorage.getItem('portfolio_history');
        const r=localStorage.getItem('portfolio_usdTry');

        if(h) holdings=JSON.parse(h);
        if(p) priceHistory=JSON.parse(p);
        if(r) usdTryRate=parseFloat(r);
    }catch(e){
        console.error(e);
    }
}
</script>

<script>
/* =========================
   ✅ Emtia genişletme (Altın zaten vardı)
   ========================= */

function getHoldingValueUSD(h){
    if(h.type==='silver'||h.type==='platinum'||h.type==='copper'){
        return h.quantity*h.currentPrice/usdTryRate;
    }
    return window.__oldGetHoldingValueUSD(h);
}
</script>

<script>
/* =========================
   ✅ PWA SERVICE WORKER
   ========================= */
if('serviceWorker'in navigator){
    navigator.serviceWorker.register('service-worker.js');
}
</script>

</body>
</html>
